<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">

<sqlMap namespace="DevPlan">

	<typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
	<typeAlias alias="searchVO" type="egovframework.let.tms.dev.service.DevPlanDefaultVO"/>
	<typeAlias  alias="DevPlanVO" type="egovframework.let.tms.dev.service.DevPlanVO"/>
	<typeAlias  alias="CmmnDetailCode"   type="egovframework.com.cmm.service.CmmnDetailCode"/>
	<typeAlias  alias="CmmnDetailCodeVO" type="egovframework.let.sym.ccm.cde.service.CmmnDetailCodeVO"/>
	
	<resultMap id="devPlanList" class="egovframework.let.tms.dev.service.DevPlanVO">
	    <result property="pgId" column="PG_ID" columnIndex="1"/>
	    <result property="planStartDt" column="PLAN_START_DT" columnIndex="2"/>
	    <result property="planEndDt" column="PLAN_END_DT" columnIndex="3"/>
	    <result property="devStartDt" column="DEV_START_DT" columnIndex="4"/>
	    <result property="devEndDt" column="DEV_END_DT" columnIndex="5"/>
	    <result property="enrollDt" column="ENROLL_DT" columnIndex="6"/>
	    <result property="devEndYn" column="DEV_END_YN" columnIndex="7"/>
	    <result property="firstTestResultYn" column="FIRST_TEST_RESULT_YN" columnIndex="8"/>
	    <result property="secondTestResultYn" column="SECOND_TEST_RESULT_YN" columnIndex="9"/>
	    <result property="thirdTestResultYn" column="THIRD_TEST_RESULT_YN" columnIndex="10"/>
	</resultMap>
	
	<resultMap id="devPlanOne" class="egovframework.let.tms.dev.service.DevPlanDefaultVO">
	    <result property="pgId" column="PG_ID" columnIndex="1"/>
	    <result property="planStartDt" column="PLAN_START_DT" columnIndex="2"/>
	    <result property="planEndDt" column="PLAN_END_DT" columnIndex="3"/>
	</resultMap>
	
	<resultMap id="devResultOne" class="egovframework.let.tms.dev.service.DevPlanDefaultVO">
	    <result property="pgId" column="PG_ID" columnIndex="1"/>
	    <result property="planStartDt" column="PLAN_START_DT" columnIndex="2"/>
	    <result property="planEndDt" column="PLAN_END_DT" columnIndex="3"/>
	    <result property="devStartDt" column="DEV_START_DT" columnIndex="4"/>
	    <result property="devEndDt" column="DEV_END_DT" columnIndex="5"/>
	</resultMap>
	
	<select id="devPlanDAO.selectDevPlans" parameterClass="searchVO" resultClass="egovMap">
			<![CDATA[
				SELECT * FROM (
					SELECT
						b.PG_ID
						,(SELECT USER_NM FROM LETTNEMPLYRINFO WHERE EMPLYR_ID = b.USER_DEV_ID ) USER_DEV_ID
						,b.PG_NM
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.SYS_GB) AS SYS_GB
						,SYS_GB AS SYS_CD
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.TASK_GB) TASK_GB
						,a.PLAN_START_DT
						,a.PLAN_END_DT
						,(select DATEDIFF(a.PLAN_END_DT, a.PLAN_START_DT )+1 )as dayDiff
						
					FROM DEV_PLAN_TB a
					INNER JOIN PG_TB b
					ON a.PG_ID = b.PG_ID
					) as c
					WHERE 1=1
			]]>
			
            <!-- 시스템구분으로 검색 -->
			<isNotEmpty property="searchBySysGb">
			    AND SYS_GB = #searchBySysGb# 
			</isNotEmpty>
			
			<isNotEmpty property="searchByTaskGb">
			    AND TASK_GB = #searchByTaskGb# 
			</isNotEmpty>
             
             
			<!-- 화면ID로 검색 -->
			<isNotEmpty property="searchByPgId">
			    AND PG_ID LIKE CONCAT ('%', #searchByPgId#, '%')
			</isNotEmpty> 
			
			<!-- 개발자명으로 검색 -->
			<isNotEmpty property="searchByUserDevId">
			    AND USER_DEV_ID LIKE CONCAT ('%', #searchByUserDevId#, '%')
			</isNotEmpty>
			
			<!-- 계획시작일로 검색 -->
			<isNotEmpty property="planStartDt">
			    <isNotEmpty property="planEndDt">
			        AND PLAN_START_DT BETWEEN DATE(#planStartDt#) AND DATE(#planEndDt#)
			    </isNotEmpty>
			</isNotEmpty>
			        
			ORDER BY PG_ID ASC
			LIMIT #recordCountPerPage# OFFSET #firstIndex#
			
			
	</select>
	
	
	<select id="DevPlanDAO.selectDevPlan" parameterClass="searchVO" resultClass="egovMap" >
		<![CDATA[
			SELECT * FROM (
					SELECT
						b.PG_ID
						,(SELECT USER_NM FROM LETTNEMPLYRINFO WHERE EMPLYR_ID = b.USER_DEV_ID ) USER_DEV_ID
						,b.PG_NM
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.SYS_GB) AS SYS_GB
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.TASK_GB) TASK_GB
						,a.PLAN_START_DT
						,a.PLAN_END_DT
						,(select DATEDIFF(a.PLAN_END_DT, a.PLAN_START_DT )+1 )as dayDiff
						
					FROM DEV_PLAN_TB a
					INNER JOIN PG_TB b
					ON a.PG_ID = b.PG_ID
					where a.PG_ID = #pgId#
					)AS one
			
				]]>				
	</select> 
	
	<insert id="DevPlanDAO.insertDevPlan" parameterClass="DevPlanVO" >
		<![CDATA[
			INSERT INTO DEV_PLAN_TB
				(PG_ID, PLAN_START_DT, PLAN_END_DT,ENROLL_DT)
			VALUES
			( #pgId#, #planStartDt#, #planEndDt#, SYSDATE()
			 )			
		]]>
	</insert>
	
	<!-- <select id="DevPlanDAO.selectDevPlans" parameterClass="searchVO" resultClass="egovMap" >
		<![CDATA[
			SELECT * FROM (
					SELECT
						b.PG_ID
						,(SELECT USER_NM FROM USER_TB WHERE USER_ID = b.USER_DEV_ID ) USER_DEV_ID
						,b.PG_NAME
						,b.SYS_GB
						,b.TASK_GB
						,b.USE_YN
						,b.PJT_ID
						,a.PLAN_START_DT
						,a.PLAN_END_DT
						,a.DEV_START_DT
						,a.DEV_END_DT
						,a.ENROLL_DT
						,a.DEV_END_YN
						,a.FIRST_TEST_RESULT_YN
						,a.SECOND_TEST_RESULT_YN
						,a.THIRD_TEST_RESULT_YN
						
					FROM DEV_PLAN_TB a
					RIGHT OUTER JOIN PG_TB b
					ON a.PG_ID = b.PG_ID
					) as c
					WHERE 1=1
		]]>
			
	</select>	 -->
	
	<select id="DevPlanDAO.selectDevPlanListTotCnt" parameterClass="searchVO" resultClass="java.lang.Integer" >
			<![CDATA[
				SELECT COUNT(*) totcnt FROM (
			SELECT
				b.PG_ID
				,(SELECT USER_NM FROM LETTNEMPLYRINFO WHERE EMPLYR_ID = b.USER_DEV_ID ) USER_DEV_ID
				,b.PG_NM
				,b.SYS_GB
				,b.TASK_GB
				,b.USE_YN
				,b.PJT_ID
				,a.PLAN_START_DT
				,a.PLAN_END_DT
				,a.DEV_START_DT
				,a.DEV_END_DT
				,a.ENROLL_DT
				,a.DEV_END_YN
				,a.FIRST_TEST_RESULT_YN
				,a.SECOND_TEST_RESULT_YN
				,a.THIRD_TEST_RESULT_YN
				
			FROM DEV_PLAN_TB a
			RIGHT OUTER JOIN PG_TB b
			ON a.PG_ID = b.PG_ID
			) as c
			WHERE 1=1
			
			]]>
			
			<!-- 개발자명으로 검색 -->
			<isNotEmpty property="searchByUserDevId">
			    AND USER_DEV_ID = #searchByUserDevId#
			</isNotEmpty>    
			
			<!-- 화면ID로 검색 -->
			<isNotEmpty property="searchByPgId">
			    AND PG_ID = #searchByPgId#
			</isNotEmpty>    
	</select>	
	
	<select id="devPlanDAO.selectDevResultList" parameterClass="searchVO" resultClass="egovMap">
			<![CDATA[
				SELECT * FROM (
					SELECT
						b.PG_ID
						,(SELECT USER_NM FROM LETTNEMPLYRINFO WHERE EMPLYR_ID = b.USER_DEV_ID ) USER_DEV_ID
						,b.PG_NM
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.SYS_GB) SYS_GB
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.TASK_GB) TASK_GB
						,b.USE_YN
						,b.PJT_ID
						,a.PLAN_START_DT
						,a.PLAN_END_DT
						,a.DEV_START_DT
						,a.DEV_END_DT
						,a.ENROLL_DT
						,a.DEV_END_YN
						,a.FIRST_TEST_RESULT_YN
						,a.SECOND_TEST_RESULT_YN
						,a.THIRD_TEST_RESULT_YN
						
					FROM DEV_PLAN_TB a
					INNER JOIN PG_TB b
					ON a.PG_ID = b.PG_ID
					) as c
					WHERE 1=1
			]]>
			
			<!-- 시스템구분으로 검색 -->
			<isNotEmpty property="searchBySysGb">
			    AND SYS_GB = #searchBySysGb# 
			</isNotEmpty>
			
			<isNotEmpty property="searchByTaskGb">
			    AND TASK_GB = #searchByTaskGb# 
			</isNotEmpty>
			
			<!-- 화면ID로 검색 -->
			<isNotEmpty property="searchByPgId">
			    AND PG_ID LIKE CONCAT ('%', #searchByPgId#, '%')
			</isNotEmpty> 
			
			<!-- 개발자명으로 검색 -->
			<isNotEmpty property="searchByUserDevId">
			    AND USER_DEV_ID LIKE CONCAT ('%', #searchByUserDevId#, '%')
			</isNotEmpty>
			
			<!-- 계획시작일로 검색 -->
			<isNotEmpty property="devStartDt">
			    <isNotEmpty property="devEndDt">
			        AND DEV_START_DT BETWEEN DATE(#devStartDt#) AND DATE(#devEndDt#)
			    </isNotEmpty>
			</isNotEmpty>
			        
			ORDER BY PG_ID ASC
			LIMIT #recordCountPerPage# OFFSET #firstIndex#
	</select>
	
	<update id="DevPlanDAO.updateDevPlan" parameterClass="DevPlanVO">
        <![CDATA[
            UPDATE DEV_PLAN_TB 
               SET PLAN_START_DT=#planStartDt#
                 , PLAN_END_DT=#planEndDt#
             WHERE PG_ID=#pgId#
        ]]>
    </update>
	
	
	<delete id="DevPlanDAO.deleteDevPlan">
        <![CDATA[
            DELETE FROM DEV_PLAN_TB 
             WHERE PG_ID=#pgId#
        ]]>
    </delete>
    
	
	<select id="DevPlanDAO.selectDevResult" parameterClass="searchVO" resultClass="egovMap">
		<![CDATA[
			SELECT * FROM (
					SELECT
						b.PG_ID
						,(SELECT USER_NM FROM LETTNEMPLYRINFO WHERE EMPLYR_ID = b.USER_DEV_ID ) USER_DEV_ID
						,b.PG_NM
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.SYS_GB) AS SYS_GB
						,(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = b.TASK_GB) TASK_GB
						,a.PLAN_START_DT
						,a.PLAN_END_DT
						,(select DATEDIFF(a.PLAN_END_DT, a.PLAN_START_DT )+1 )as dayDiff
						,a.DEV_START_DT
						,a.DEV_END_DT
						
					FROM DEV_PLAN_TB a
					INNER JOIN PG_TB b
					ON a.PG_ID = b.PG_ID
					where a.PG_ID = #pgId#
					)AS resultOne
			
				]]>				
	</select> 
    
<!-- 	
	<insert id="DevPlanDAO.insertDevResult" parameterClass="DevPlanVO" >
		<![CDATA[
			INSERT INTO DEV_PLAN_TB
				(PG_ID, PLAN_START_DT, PLAN_END_DT,DEV_START_DT, DEV_END_DT, ENROLL_DT)
			VALUES
			( #pgId#, #planStartDt#, #planEndDt#, #devStartDt#, #devEndDt#, '2018-09-09'
			 )			
		]]>
	</insert>
	 -->
	<update id="DevPlanDAO.updateDevResult" parameterClass="DevPlanVO">
        <![CDATA[
            UPDATE DEV_PLAN_TB 
               SET DEV_START_DT=#devStartDt#
                 , DEV_END_DT=#devEndDt#
             WHERE PG_ID=#pgId#
        ]]>
    </update>
    
	<update id="DevPlanDAO.deleteDevResult" parameterClass="DevPlanVO">
        <![CDATA[
            UPDATE DEV_PLAN_TB 
               SET DEV_START_DT=NULL
                 , DEV_END_DT=NULL
             WHERE PG_ID=#pgId#
        ]]>
    </update>
    
	<select id="DevPlanDAO.selectDevPeriod" resultClass="egovMap">
		<![CDATA[
			select
 				date_add('2018-09-17', interval n.no week) as weeks,
				 date_format(
				    if(
				      weekday(
				        date_add('2018-09-17', interval n.no week)
				      ) = 4, 
				      date_add('2018-09-17', interval n.no week), 
				      date_add(
				        date_add('2018-09-17', interval n.no week), 
				        interval (
				          4 + weekday(
				            date_add('2018-09-17', interval n.no week)
				          )
				        ) DAY
				      )
				    ), 
				    '%m/%d'
				  ) AS formatFriday
				  from NUMBERS as n
				WHERE 
				  n.no < 6;
				]]>				
	</select> 
	
	<insert id="DevPlanDAO.insertWeek" parameterClass="java.lang.Integer" >
		<![CDATA[
			INSERT INTO TEST
				(weekyear)
			VALUES
			(#i#)			
		]]>
	</insert>
	
	<delete id="DevPlanDAO.deleteWeek">
        <![CDATA[
            DELETE FROM TEST
        ]]>
    </delete>
    
	
	
	
	
<!-- 
	<resultMap id="tmplatDetail" class="egovframework.let.cop.com.service.TemplateInfVO">
		<result property="tmplatId" column="TMPLAT_ID" columnIndex="1"/>
		<result property="tmplatNm" column="TMPLAT_NM" columnIndex="2"/>
		<result property="tmplatSeCode" column="TMPLAT_SE_CODE" columnIndex="3"/>
		<result property="tmplatSeCodeNm" column="TMPLAT_SE_CODE_NM" columnIndex="4"/>
		<result property="tmplatCours" column="TMPLAT_COURS" columnIndex="5"/>
		<result property="useAt" column="USE_AT" columnIndex="6"/>
		<result property="frstRegisterId" column="FRST_REGISTER_ID" columnIndex="7"/>
		<result property="frstRegisterNm" column="FRST_REGISTER_NM" columnIndex="8"/>
		<result property="frstRegisterPnttm" column="FRST_REGIST_PNTTM" columnIndex="9"/>
		<result property="lastUpdusrId" column="LAST_UPDUSR_ID" columnIndex="10"/>
		<result property="lastUpdusrNm" column="LAST_UPDUSR_NM" columnIndex="11"/>
		<result property="lastUpdusrPnttm" column="LAST_UPDT_PNTTM" columnIndex="12"/>
	</resultMap> -->
	
	
</sqlMap>
