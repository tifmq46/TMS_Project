<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE sqlMap PUBLIC "-//iBATIS.com//DTD SQL Map 2.0//EN" "http://www.ibatis.com/dtd/sql-map-2.dtd">
<sqlMap namespace="Program">
    <typeAlias  alias="egovMap" type="egovframework.rte.psl.dataaccess.util.EgovMap"/>
    <typeAlias  alias="ProgramDefaultVO" type="egovframework.let.tms.pg.service.ProgramDefaultVO"/>
	<typeAlias  alias="ProgramVO" type="egovframework.let.tms.pg.service.ProgramVO"/>
	<typeAlias  alias="PgCurrentVO" type="egovframework.let.tms.pg.service.PgCurrentVO"/>
    
	<!-- return 결과물을 의미 -->
	<resultMap id="PgList" class="egovframework.let.tms.pg.service.ProgramVO">
	    <result property="PG_ID" column="PG_ID" columnIndex="1"/>
	    <result property="PG_NM" column="PG_NM" columnIndex="2"/>
	    <result property="USER_DEV_ID" column="USER_DEV_ID" columnIndex="3"/>
	    <result property="SYS_GB" column="SYS_GB" columnIndex="4"/>
	    <result property="TASK_GB" column="TASK_GB" columnIndex="5"/>
	    <result property="USE_YN" column="USE_YN" columnIndex="6"/>
	</resultMap>
	
	<resultMap id="PgCurrent" class="egovframework.let.tms.pg.service.PgCurrentVO">
	    <result property="PG_ID" column="PG_ID" columnIndex="1"/>
	    <result property="PG_NM" column="PG_NM" columnIndex="2"/>
	    <result property="USER_DEV_ID" column="USER_DEV_ID" columnIndex="3"/>
	    <result property="DEV_END_DT" column="DEV_END_DT" columnIndex="4"/>
	    <result property="DEV_END_YN" column="DEV_END_YN" columnIndex="5"/>
	    <result property="SECOND_TEST_RESULT_YN" column="SECOND_TEST_RESULT_YN" columnIndex="6"/>
	    <result property="THIRD_TEST_RESULT_YN" column="THIRD_TEST_RESULT_YN" columnIndex="7"/>
	</resultMap>
		
	
	
	<select id="ProgramDAO.selectPgList" parameterClass="ProgramDefaultVO" resultMap="PgList" >
		<![CDATA[
			SELECT
				a.PG_ID, 
				a.PG_NM, 
				(SELECT LETTNEMPLYRINFO.USER_NM FROM LETTNEMPLYRINFO WHERE a.USER_DEV_ID = LETTNEMPLYRINFO.EMPLYR_ID) AS USER_DEV_ID,				
				(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = a.SYS_GB) AS SYS_GB, 
				(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = a.TASK_GB) AS TASK_GB,
				a.USE_YN
			FROM 
				PG_TB a
			WHERE 
				1=1			
		]]>
			<!-- 화면ID로 검색 -->
			<isNotEmpty property="searchByPgId">
			    AND a.PG_ID LIKE CONCAT('%' , #searchByPgId#, '%')
			</isNotEmpty>  
			
			<!-- 시스템구분으로 검색 -->
			<isNotEmpty property="searchBySysGb">
			    AND a.SYS_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #searchBySysGb#)
			</isNotEmpty>
			
			<isNotEmpty property="searchByTaskGb">
			    AND a.TASK_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #searchByTaskGb#)
			</isNotEmpty>
			
			<!-- 개발자명으로 검색 -->
			<isNotEmpty property="searchByUserDevId">
			    AND a.USER_DEV_ID IN (SELECT EMPLYR_ID FROM LETTNEMPLYRINFO WHERE USER_NM LIKE CONCAT('%' , #searchByUserDevId#, '%'))
			</isNotEmpty> 
			LIMIT 
				#recordCountPerPage# OFFSET #firstIndex#
	</select>	
	
	<!-- 조회 검색 -->

	
	
	
   <select id="ProgramDAO.selectPgListTotCnt" parameterClass="ProgramDefaultVO" resultClass="java.lang.Integer" >
         <![CDATA[
            SELECT COUNT(*) totcnt 
            FROM PG_TB a
            WHERE 1=1
         ]]>
         <!-- 화면ID로 검색 -->
         <isNotEmpty property="searchByPgId">
             AND a.PG_ID LIKE CONCAT('%' , #searchByPgId#, '%')
         </isNotEmpty>  
         
         <!-- 시스템구분으로 검색 -->
         <isNotEmpty property="searchBySysGb">
             AND a.SYS_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #searchBySysGb#)
         </isNotEmpty>
         
         <isNotEmpty property="searchByTaskGb">
             AND a.TASK_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #searchByTaskGb#)
         </isNotEmpty>
         
         <!-- 개발자명으로 검색 -->
         <isNotEmpty property="searchByUserDevId">
             AND a.USER_DEV_ID IN (SELECT EMPLYR_ID FROM LETTNEMPLYRINFO WHERE USER_NM LIKE CONCAT('%' , #searchByUserDevId#, '%'))
         </isNotEmpty> 
   </select>
	
	
	<!-- 프로그램현황 조회(엑셀 다운용) -->
	<select id="ProgramDAO.selectPgCurrentExcelList" parameterClass="ProgramDefaultVO" resultMap="PgList" >
		<![CDATA[
			SELECT
				a.PG_ID, 
				a.PG_NM, 
				(SELECT LETTNEMPLYRINFO.USER_NM FROM LETTNEMPLYRINFO WHERE a.USER_DEV_ID = LETTNEMPLYRINFO.EMPLYR_ID) AS USER_DEV_ID,
				a.SYS_GB, 
				a.TASK_GB, 
				a.USE_YN
			FROM 
				PG_TB a
			WHERE 
				1=1			
		]]>
			<!-- 화면ID로 검색 -->
			<isNotEmpty property="searchByPgId">
			    AND a.PG_ID LIKE CONCAT('%' , #searchByPgId#, '%')
			</isNotEmpty>  
			
			<!-- 시스템구분으로 검색 -->
			<isNotEmpty property="searchBySysGb">
			    AND a.SYS_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #searchBySysGb#)
			</isNotEmpty>
			
			<isNotEmpty property="searchByTaskGb">
			    AND a.TASK_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #searchByTaskGb#)
			</isNotEmpty>
			
			<!-- 개발자명으로 검색 -->
			<isNotEmpty property="searchByUserDevId">
			    AND a.USER_DEV_ID IN (SELECT EMPLYR_ID FROM LETTNEMPLYRINFO WHERE USER_NM LIKE CONCAT('%' , #searchByUserDevId#, '%'))
			</isNotEmpty> 
	</select>	
	
	<!-- 프로그램현황 수 확인 -->
	<select id="ProgramDAO.selectPgCurrentTotCnt" resultClass="java.lang.Integer" >
			<![CDATA[
			SELECT
				COUNT(*) totcnt 
			FROM 
				PG_TB a, DEV_PLAN_TB b
			WHERE
				a.PG_ID = b.PG_ID 
			]]>
			
		
	</select>
	
	
	
	<!-- 상세 조회 -->
	<select id="ProgramDAO.selectProgramInf" parameterClass="ProgramVO" resultMap="PgList">
		<![CDATA[
			SELECT
				a.PG_ID, 
				a.PG_NM, 
				(SELECT LETTNEMPLYRINFO.USER_NM FROM LETTNEMPLYRINFO WHERE a.USER_DEV_ID = LETTNEMPLYRINFO.EMPLYR_ID) AS USER_DEV_ID,
				(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = a.SYS_GB) AS SYS_GB, 
				(SELECT CODE_NM FROM LETTCCMMNDETAILCODE WHERE CODE = a.TASK_GB) AS TASK_GB, 
				a.USE_YN
			FROM 
				PG_TB a
			WHERE
				a.PG_ID = #PG_ID#
		]]>
			
	</select>
	
	
	
	<!-- 삽입 -->
	<insert id="ProgramDAO.insertPg" parameterClass="ProgramVO" >
		<![CDATA[
		    INSERT 
		      INTO  PG_TB
		         (  PG_ID
		         ,  USER_DEV_ID
		         ,  PG_NM
		         ,  SYS_GB
		         ,  TASK_GB
		         ,  USE_YN
		         ,  PJT_ID
		         ) 
		    VALUES  
		         (  #PG_ID#
		         ,  (SELECT EMPLYR_ID FROM LETTNEMPLYRINFO WHERE USER_NM LIKE CONCAT(#USER_DEV_ID#))
		         ,  #PG_NM#
		         ,  (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #SYS_GB# AND CODE != 'T9')
		         ,  (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #TASK_GB# AND CODE != 'T10')
		         ,  #USE_YN#
		         ,  #PJT_ID#
		         ) 
		]]>
	</insert>
	
	<!-- 수정 -->
	<update id="ProgramDAO.updatePg" parameterClass="ProgramVO">
 		<![CDATA[
			UPDATE PG_TB SET 
				USER_DEV_ID = (SELECT EMPLYR_ID FROM LETTNEMPLYRINFO WHERE USER_NM LIKE CONCAT(#USER_DEV_ID#)), 
				PG_NM = #PG_NM#,
				SYS_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #SYS_GB# AND CODE != 'T9'),
				TASK_GB = (SELECT CODE FROM LETTCCMMNDETAILCODE WHERE CODE_NM = #TASK_GB# AND CODE != 'T10'),
				USE_YN = #USE_YN#				
			WHERE PG_ID = #PG_ID#
 		]]>
 	</update>
 	
	<!-- 삭제 -> 사용여부 변경 -->
	<update id="ProgramDAO.deletePg" parameterClass="ProgramVO">
 		<![CDATA[
 			DELETE FROM PG_TB
 			WHERE PG_ID = #PG_ID#
 		]]>
 	</update>
	
    
</sqlMap>